/**
 * SSAS - Simple Smart Automotive Software
 * Copyright (C) 2021 Parai Wang <parai@foxmail.com>
 */

/* ================================ [ INCLUDES  ] ============================================== */
#include "io.h"
/* ============================ [ MACROS] ====================================================== */
/* ref qemu/hw/arm/virt.c */
#define UART0DR 0x09000000
#define UART0FR 0x09000018

/* ================================ [ TYPES     ] ============================================== */
/* ================================ [ DECLARES  ] ============================================== */
/* ================================ [ DATAS     ] ============================================== */
/* ================================ [ LOCALS    ] ============================================== */
/* ================================ [ FUNCTIONS ] ============================================== */
void uart_putc(char byte) {
  while (readl(UART0FR) & (1 << 5)) {
  }
  writel(UART0DR, byte);
}

int uart_getc(void) {
  if ((readl(UART0FR) & (1 << 6))) {
    return readl(UART0DR);
  }

  return -1;
}

void __putchar(char ch) {
  uart_putc(ch);
}
